<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ù–ü–£ | –ï–ª–µ–∫—Ç—Ä–æ–Ω–Ω–∞ –°–∏—Å—Ç–µ–º–∞</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root { --blue: #0057b7; --yellow: #ffd700; --bg: #05111d; --card: #0a1a2a; }
        body { font-family: 'Montserrat', sans-serif; background: var(--bg); color: white; margin: 0; min-height: 100vh; overflow-x: hidden; }
        #particles-js { position: fixed; inset: 0; z-index: -1; }

        .logo-text { font-weight: 900; text-transform: uppercase; text-align: center; color: white; text-shadow: 0 0 10px var(--blue); }
        .top-nav { position: fixed; top: 20px; right: 20px; display: flex; gap: 10px; z-index: 100; }
        .nav-btn { background: var(--blue); border: 2px solid white; padding: 10px 20px; border-radius: 50px; color: white; font-weight: 800; cursor: pointer; transition: 0.3s; }

        .wrapper { display: flex; flex-direction: column; align-items: center; padding: 60px 20px; }
        .form-box { background: var(--card); padding: 35px; border-radius: 30px; border: 1px solid rgba(255,255,255,0.1); width: 100%; max-width: 500px; box-shadow: 0 20px 50px rgba(0,0,0,0.6); backdrop-filter: blur(10px); }
        
        input, textarea { width: 100%; padding: 14px; margin: 10px 0 15px; border-radius: 12px; border: 1px solid #1a3a5a; background: #000; color: white; box-sizing: border-box; outline: none; }
        .submit-btn { width: 100%; padding: 18px; border-radius: 15px; border: none; background: linear-gradient(45deg, var(--blue), #003d80); color: white; font-weight: 900; cursor: pointer; text-transform: uppercase; }

        .modal { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.95); z-index: 5000; align-items: center; justify-content: center; padding: 15px; }
        .modal-content { background: #071624; width: 100%; max-width: 800px; height: 85vh; border-radius: 30px; border: 1px solid var(--blue); position: relative; padding: 30px; display: flex; flex-direction: column; }
        .scroll-area { flex: 1; overflow-y: auto; margin-top: 20px; padding-right: 10px; }

        /* –ö–∞—Ä—Ç–∫–∞ —Å–∫–∞—Ä–≥–∏ */
        .complaint-card { background: rgba(255,255,255,0.05); padding: 15px 20px; border-radius: 15px; margin-bottom: 10px; border-left: 5px solid var(--blue); cursor: pointer; transition: 0.2s; }
        .card-header { display: flex; justify-content: space-between; align-items: center; font-weight: 700; font-size: 14px; }
        .card-body { display: none; margin-top: 15px; padding-top: 15px; border-top: 1px solid rgba(255,255,255,0.1); cursor: default; }
        .card-body.active { display: block; }

        .tag { padding: 4px 10px; border-radius: 6px; font-size: 10px; font-weight: 900; text-transform: uppercase; color: white; }
        .tag-waiting { background: #ff8c00; }
        .tag-approved { background: #22c55e; }
        .tag-rejected { background: #ef4444; }

        .btn-group { display: flex; gap: 5px; margin-top: 15px; }
        .adm-btn { flex: 1; padding: 10px; border-radius: 8px; border: none; font-weight: 700; cursor: pointer; color: white; font-size: 10px; }

        .close-x { position: absolute; top: 20px; right: 25px; font-size: 35px; cursor: pointer; }
    </style>
</head>
<body>

<div id="particles-js"></div>

<div class="top-nav">
    <button class="nav-btn" onclick="openM('playerAuthModal')"><i class="fas fa-search"></i> –ú–û–á –°–ö–ê–†–ì–ò</button>
    <button class="nav-btn" style="background: #111;" onclick="checkAccess()"><i class="fas fa-shield-alt"></i> –ë–ê–ó–ê –ù–ü–£</button>
</div>

<div class="wrapper">
    <header style="text-align: center; margin-bottom: 30px;">
        <img src="https://i.postimg.cc/2575QP74/removebg-preview.png" style="width: 100px;">
        <h2 class="logo-text">–ï–ª–µ–∫—Ç—Ä–æ–Ω–Ω—ñ —Å–∫–∞—Ä–≥–∏ –ù–ü–£</h2>
    </header>

    <div class="form-box">
        <input type="text" id="sName" placeholder="–í–∞—à –ù—ñ–∫–Ω–µ–π–º">
        <input type="text" id="cName" placeholder="–ù—ñ–∫–Ω–µ–π–º –ø–æ—Ä—É—à–Ω–∏–∫–∞">
        <textarea id="desc" rows="4" placeholder="–û–ø–∏—à—ñ—Ç—å —Å–∏—Ç—É–∞—Ü—ñ—é..."></textarea>
        <input type="text" id="proofLink" placeholder="–ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –¥–æ–∫–∞–∑–∏">
        <button class="submit-btn" onclick="sendData()">–í–Ü–î–ü–†–ê–í–ò–¢–ò</button>
    </div>
</div>

<div id="playerAuthModal" class="modal">
    <div class="modal-content" style="max-width: 400px; height: auto;">
        <span class="close-x" onclick="closeM('playerAuthModal')">&times;</span>
        <h3 class="logo-text">–ü–ï–†–ï–í–Ü–†–ö–ê</h3>
        <input type="text" id="playerSearch" placeholder="–í–∞—à –Ω—ñ–∫–Ω–µ–π–º">
        <button class="submit-btn" onclick="searchMyComplaints()">–ó–ù–ê–ô–¢–ò</button>
    </div>
</div>

<div id="playerListModal" class="modal">
    <div class="modal-content">
        <span class="close-x" onclick="closeM('playerListModal')">&times;</span>
        <h2 class="logo-text" id="pTitle">–í–∞—à—ñ —Å–∫–∞—Ä–≥–∏</h2>
        <div id="pList" class="scroll-area"></div>
    </div>
</div>

<div id="dbModal" class="modal">
    <div class="modal-content">
        <span class="close-x" onclick="closeM('dbModal')">&times;</span>
        <h2 class="logo-text" style="text-align: left;"><i class="fas fa-database"></i> –ë–ê–ó–ê –î–ê–ù–ò–• –ù–ü–£</h2>
        <div id="adminList" class="scroll-area"></div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/particles.js@2.0.0/particles.min.js"></script>
<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-app.js";
    import { getDatabase, ref, push, onValue, update, get, child } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-database.js";

    const cfg = { apiKey: "AIzaSyCK5b9Ls2eWy1FGPjq738wVRWBJ8KhLdPg", databaseURL: "https://complaint-dbe8b-default-rtdb.firebaseio.com/" };
    const app = initializeApp(cfg);
    const db = getDatabase(app);

    let allComplaints = {};

    // –ü–æ—Å—Ç—ñ–π–Ω–µ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –±–∞–∑–∏ –¥–ª—è –∞–¥–º—ñ–Ω–∞
    onValue(ref(db, 'complaints'), (snapshot) => {
        allComplaints = snapshot.val() || {};
        renderAdmin();
    });

    window.sendData = () => {
        const d = {
            from: document.getElementById('sName').value.trim(),
            target: document.getElementById('cName').value.trim(),
            text: document.getElementById('desc').value.trim(),
            link: document.getElementById('proofLink').value.trim(),
            status: "waiting", 
            date: new Date().toLocaleString('uk-UA')
        };
        if(!d.from || !d.text) return alert("–ó–∞–ø–æ–≤–Ω—ñ—Ç—å —Ñ–æ—Ä–º—É!");
        push(ref(db, 'complaints'), d).then(() => { alert("–°–∫–∞—Ä–≥—É –Ω–∞–¥—ñ—Å–ª–∞–Ω–æ!"); location.reload(); });
    };

    // –ü–ï–†–ï–ì–õ–Ø–î –î–õ–Ø –ù–ü–£ (–ê–∫–æ—Ä–¥–µ–æ–Ω)
    function renderAdmin() {
        const list = document.getElementById('adminList');
        if(!list) return;
        list.innerHTML = "";
        Object.entries(allComplaints).reverse().forEach(([id, item]) => {
            const card = document.createElement('div');
            card.className = 'complaint-card';
            card.innerHTML = `
                <div class="card-header" onclick="toggleCard('${id}')">
                    <span><i class="fas fa-user-circle"></i> –ó–∞—è–≤–Ω–∏–∫: ${item.from}</span>
                    <span class="tag tag-${item.status}">${getStatusName(item.status)}</span>
                </div>
                <div id="body-${id}" class="card-body">
                    <p><b>–ü–æ—Ä—É—à–Ω–∏–∫:</b> ${item.target}</p>
                    <p><b>–û–ø–∏—Å:</b> ${item.text}</p>
                    <p><b>–î–∞—Ç–∞:</b> ${item.date}</p>
                    ${item.link ? `<a href="${item.link}" target="_blank" style="color:var(--yellow)">üîó –î–æ–∫–∞–∑–∏ –∑–∞ –ø–æ—Å–∏–ª–∞–Ω–Ω—è–º</a>` : ''}
                    <div class="btn-group">
                        <button class="adm-btn" style="background:#ff8c00" onclick="setStatus('${id}', 'waiting')">–ù–∞ —Ä–æ–∑–≥–ª—è–¥</button>
                        <button class="adm-btn" style="background:#22c55e" onclick="setStatus('${id}', 'approved')">–°—Ö–≤–∞–ª–∏—Ç–∏</button>
                        <button class="adm-btn" style="background:#ef4444" onclick="setStatus('${id}', 'rejected')">–í—ñ–¥–º–æ–≤–∏—Ç–∏</button>
                    </div>
                </div>
            `;
            list.appendChild(card);
        });
    }

    // –ü–û–®–£–ö –î–õ–Ø –ì–†–ê–í–¶–Ø
    window.searchMyComplaints = async () => {
        const nick = document.getElementById('playerSearch').value.trim().toLowerCase();
        const list = document.getElementById('pList');
        if(!nick) return alert("–í–≤–µ–¥—ñ—Ç—å –Ω—ñ–∫–Ω–µ–π–º!");

        list.innerHTML = "<p style='text-align:center'>–®—É–∫–∞—î–º–æ –≤–∞—à—ñ –∑–∞–ø–∏—Å–∏...</p>";
        
        const snapshot = await get(child(ref(db), 'complaints'));
        list.innerHTML = "";
        
        if (snapshot.exists()) {
            const data = snapshot.val();
            let count = 0;
            Object.values(data).reverse().forEach(item => {
                if(item.from && item.from.toLowerCase() === nick) {
                    count++;
                    list.innerHTML += `
                        <div class="complaint-card" style="cursor:default">
                            <div class="card-header">
                                <span>–ù–∞: ${item.target}</span>
                                <span class="tag tag-${item.status}">${getStatusName(item.status)}</span>
                            </div>
                            <p style="font-size:12px; margin-top:10px; opacity:0.8">${item.text}</p>
                        </div>
                    `;
                }
            });
            if(count === 0) list.innerHTML = "<p style='text-align:center'>–°–∫–∞—Ä–≥ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ.</p>";
        }
        closeM('playerAuthModal');
        document.getElementById('playerListModal').style.display = 'flex';
    };

    window.toggleCard = (id) => {
        const b = document.getElementById(`body-${id}`);
        const active = b.classList.contains('active');
        document.querySelectorAll('.card-body').forEach(el => el.classList.remove('active'));
        if(!active) b.classList.add('active');
    };

    window.setStatus = (id, s) => update(ref(db, `complaints/${id}`), { status: s });
    
    function getStatusName(s) {
        if(s === 'approved') return '–°—Ö–≤–∞–ª–µ–Ω–æ';
        if(s === 'rejected') return '–í—ñ–¥–º–æ–≤–∞';
        return '–†–æ–∑–≥–ª—è–¥';
    }

    window.checkAccess = () => { document.getElementById('dbModal').style.display = 'flex'; };
    window.closeM = (id) => document.getElementById(id).style.display = 'none';
    window.openM = (id) => document.getElementById(id).style.display = 'flex';

    particlesJS("particles-js", { "particles": { "number": { "value": 20 }, "move": { "speed": 1 } } });
</script>
</body>
</html>
